<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MJS é£²é£Ÿåº—SNSæŠ•ç¨¿ãƒŠãƒ“</title>
    
    <!-- Fonts: Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Icons: Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Color Palette - Luxury Update */
            --primary: #A62C2B;
            --primary-dark: #7a1f1e;
            --primary-gradient: linear-gradient(135deg, #A62C2B 0%, #631110 100%);
            --gold: #D4AF37;
            --gold-light: #F3E5AB;
            --gold-gradient: linear-gradient(135deg, #D4AF37 0%, #AA8A26 100%);
            
            /* Base Colors */
            --dark: #231815;
            --base: #ECECEC;
            --white: #ffffff;
            --gray-light: #f5f5f5;
            --gray-text: #666666;
            
            /* Theme Variables (Light Default) */
            --bg-body: #ECECEC;
            --bg-card: #ffffff;
            --text-main: #231815;
            --text-sub: #666666;
            --border-color: #e0e0e0;
            --input-bg: #f9f9f9;
            --glass-bg: rgba(255, 255, 255, 0.90);
            --modal-bg: #ffffff;
            --shadow-soft: 0 10px 40px -10px rgba(35, 24, 21, 0.15);
            --shadow-sharp: 0 2px 8px rgba(0,0,0,0.08);
        }

        [data-theme="dark"] {
            --bg-body: #120c0b;
            --bg-card: #231815;
            --text-main: #ECECEC;
            --text-sub: #aaaaaa;
            --border-color: #3e2b26;
            --input-bg: #2d201d;
            --glass-bg: rgba(35, 24, 21, 0.95);
            --modal-bg: #231815;
            --shadow-soft: 0 10px 40px -10px rgba(0, 0, 0, 0.6);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            padding-bottom: 80px;
            transition: background-color 0.4s cubic-bezier(0.22, 1, 0.36, 1), color 0.4s;
            overflow-x: hidden;
            line-height: 1.6;
            /* èƒŒæ™¯ã«ã†ã£ã™ã‚‰ã¨ãƒã‚¤ã‚ºã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å…¥ã‚Œã¦é«˜ç´šæ„Ÿã‚’å‡ºã™ï¼ˆCSSã®ã¿ã§è¡¨ç¾ï¼‰ */
            background-image: radial-gradient(circle at 50% 0%, rgba(166, 44, 43, 0.03) 0%, transparent 70%);
        }

        /* --- UI Utilities --- */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .btn {
            border: none;
            outline: none;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            border-radius: 12px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .card {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 24px;
            box-shadow: var(--shadow-soft);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 70px;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        }

        .app-brand {
            /* position: absolute; å‰Šé™¤ï¼šå·¦å¯„ã›ã«ã™ã‚‹ãŸã‚çµ¶å¯¾é…ç½®ã‚’è§£é™¤ */
            /* left: 50%; */
            /* top: 50%; */
            /* transform: translate(-50%, -50%); */
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.4rem; /* å¤‰æ›´ï¼šã‚¹ãƒãƒ›ã§å¹…ã‚’å–ã‚Šã™ããªã„ã‚ˆã†å°‘ã—èª¿æ•´ */
            color: var(--primary);
            white-space: nowrap;
            z-index: 103;
            cursor: pointer;
            letter-spacing: 0.05em;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px; /* ã‚¢ã‚¤ã‚³ãƒ³é–“ã®ä½™ç™½ */
            z-index: 102;
            margin-left: auto; /* å³ç«¯ã¸å¯„ã›ã‚‹ */
        }

        .header-actions button {
            background: transparent;
            color: var(--text-main);
            font-size: 1.3rem;
            padding: 8px;
            color: var(--primary); /* è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã‚‚ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ã« */
        }

        .header-spacer {
            height: 90px;
        }

        /* --- Tab Navigation (Floating Style) --- */
        .tabs {
            display: flex;
            background: var(--bg-card);
            padding: 6px;
            border-radius: 50px; /* ä¸¸ã¿ã‚’å¼·ã */
            margin-bottom: 24px;
            box-shadow: var(--shadow-soft);
            position: relative;
            border: 1px solid var(--border-color);
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-sub);
            background: transparent;
            transition: all 0.3s ease;
            border: none;
        }

        .tab-btn.active {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(166, 44, 43, 0.4);
        }

        /* Sub Tabs for Tips (New) */
        .sub-tabs {
            display: flex;
            background: var(--input-bg);
            padding: 4px;
            border-radius: 12px;
            margin: 16px 0;
            border: 1px solid var(--border-color);
        }
        .sub-tab-btn {
            flex: 1;
            padding: 8px;
            text-align: center;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-sub);
            background: transparent;
            border: none;
            transition: all 0.2s;
        }
        .sub-tab-btn.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* --- Inputs --- */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-sub);
            margin-bottom: 10px;
            padding-left: 4px;
        }
        .form-label i { color: var(--gold); } /* ã‚¢ã‚¤ã‚³ãƒ³ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */

        .input-control {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-main);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
            appearance: none;
        }

        .input-control:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--bg-card);
            box-shadow: 0 0 0 3px rgba(166, 44, 43, 0.1);
        }

        select.input-control {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23A62C2B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        /* --- Generate Button --- */
        .generate-btn {
            width: 100%;
            padding: 20px;
            font-size: 1.1rem;
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 10px 30px rgba(166, 44, 43, 0.3);
            margin-top: 10px;
            letter-spacing: 1px;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .generate-btn::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
            transform: skewX(-20deg) translateX(-150%);
            transition: transform 0.5s;
        }

        .generate-btn:hover::after {
            transform: skewX(-20deg) translateX(150%);
        }

        /* --- Output Area --- */
        #output-area {
            display: none;
            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .result-text {
            white-space: pre-wrap;
            font-size: 1rem;
            color: var(--text-main);
            background: var(--input-bg);
            padding: 20px;
            border-radius: 16px 16px 0 0; /* ä¸‹ã®è§’ä¸¸ã‚’ãªãã—ã¦ãƒœã‚¿ãƒ³ã¨ä¸€ä½“åŒ– */
            margin-bottom: 0;
            border: 1px solid var(--border-color);
            border-bottom: none;
            min-height: 200px;
            line-height: 1.7;
        }

        /* ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã¨çµåˆï¼‰ */
        .copy-action-area {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 16px 16px;
            padding: 10px 20px 20px 20px;
            margin-bottom: 30px;
        }

        .copy-btn-full {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(166, 44, 43, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .copy-btn-full:active { transform: scale(0.98); }

        .photo-suggestions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }

        .photo-chip {
            background: var(--bg-card);
            color: var(--text-main);
            padding: 16px;
            border-radius: 16px;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            box-shadow: var(--shadow-sharp);
        }

        .photo-chip-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            color: var(--primary);
        }

        .photo-chip i {
            font-size: 1.2rem;
            min-width: 24px;
            text-align: center;
            color: var(--gold); /* ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚´ãƒ¼ãƒ«ãƒ‰ã« */
        }

        .photo-chip-desc {
            font-size: 0.85rem;
            color: var(--text-sub);
            padding-left: 34px;
            line-height: 1.6;
        }
        
        /* ç®‡æ¡æ›¸ãç”¨ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ  */
        .photo-chip-desc ul {
            margin: 8px 0;
            padding-left: 18px;
            list-style-type: disc; /* é»’ä¸¸ */
        }
        .photo-chip-desc li {
            margin-bottom: 4px;
        }
        .photo-chip-point {
            background: rgba(166, 44, 43, 0.08);
            color: var(--primary);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-top: 8px;
            display: flex;
            align-items: flex-start;
            gap: 6px;
        }

        .action-row {
            display: flex;
            gap: 10px;
            margin-top: 24px;
        }

        .action-btn {
            flex: 1;
            padding: 16px;
            font-size: 1rem;
            background: var(--white);
            color: var(--text-main);
            border: 1px solid var(--border-color);
            border-radius: 14px;
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(166, 44, 43, 0.2);
        }

        /* --- History --- */
        .history-section {
            margin-top: 40px;
            padding: 0 10px;
        }
        
        .history-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-sub);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }

        .history-list {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 4px 4px 20px 4px;
        }

        .history-card {
            min-width: 150px;
            max-width: 150px;
            background: var(--bg-card);
            padding: 16px;
            border-radius: 16px;
            font-size: 0.75rem;
            box-shadow: var(--shadow-soft);
            cursor: pointer;
            border: 1px solid var(--border-color);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 120px;
            transition: transform 0.2s;
        }
        .history-card:active { transform: scale(0.95); }

        .history-content {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            color: var(--text-sub);
            line-height: 1.4;
        }

        .history-date {
            margin-top: 6px;
            color: var(--primary);
            font-weight: 700;
            font-size: 0.7rem;
        }

        /* --- Modal (Settings & Howto) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 200;
            display: flex;
            align-items: flex-end; /* ä¸‹å¯„ã› */
            justify-content: center; /* ä¸­å¤®å¯„ã› */
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            backdrop-filter: blur(4px);
            padding-bottom: 20px; /* ä¸‹ç«¯ã‹ã‚‰å°‘ã—æµ®ã‹ã›ã‚‹ */
        }

        .modal-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            width: 92%; /* ç”»é¢å¹…ã®92%ã«è¨­å®šï¼ˆå·¦å³ã«ä½™ç™½ï¼‰ */
            max-width: 480px; /* PCãªã©ã§åºƒãŒã‚Šã™ããªã„ã‚ˆã†æœ€å¤§å¹…ã‚’åˆ¶é™ */
            background: var(--modal-bg);
            border-radius: 24px; /* å…¨å‘¨ã‚’è§’ä¸¸ã« */
            padding: 0;
            max-height: 85vh; /* ç”»é¢é«˜ã•ã®85%ã¾ã§ */
            overflow-y: auto;
            transform: translateY(120%); /* ç”»é¢å¤–ã¸éš ã™ */
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4); /* æµ®éŠæ„Ÿã‚’å‡ºã™å½± */
        }

        .modal-overlay.open .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px 24px;
            background: var(--bg-card);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-btn {
            background: var(--input-bg);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Setting Sections */
        .setting-section {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-section-title {
            font-size: 0.85rem;
            color: var(--text-sub);
            font-weight: 700;
            margin-bottom: 16px;
            letter-spacing: 0.05em;
        }

        /* Simple Menu Links (Replaces Banner) */
        .menu-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--input-bg);
            border-radius: 12px;
            text-decoration: none;
            color: var(--text-main);
            margin-bottom: 10px;
            transition: all 0.2s;
            border: 1px solid var(--border-color);
        }
        .menu-link:hover {
            background: var(--bg-card);
            border-color: var(--primary);
        }
        .menu-link-content {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }
        .menu-link i {
            color: var(--primary);
            width: 20px;
            text-align: center;
        }
        .menu-link-arrow {
            color: var(--text-sub);
            font-size: 0.9rem;
        }

        /* Footer */
        .app-footer {
            text-align: center;
            padding: 10px 0 30px 0;
            font-size: 0.75rem;
            color: var(--text-sub);
            opacity: 0.6;
        }

        /* --- Toast --- */
        .toast {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(35, 24, 21, 0.95);
            color: #fff;
            padding: 14px 28px;
            border-radius: 50px;
            font-size: 0.95rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            z-index: 300;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Floating Action Button (Help) */
        .help-fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 48px;
            height: 48px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-sub);
            box-shadow: var(--shadow-soft);
            z-index: 90;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .help-fab:active { transform: scale(0.9); }

        /* Animations */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--input-bg);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid var(--border-color);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-sub);
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .slider {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        input:checked + .slider:before {
            transform: translateX(24px);
            background-color: white;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="glass">
        <!-- ä¸­å¤®ï¼šã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ãƒªãƒ­ãƒ¼ãƒ‰ï¼‰ -->
        <div class="app-brand" onclick="location.reload()">
            <i class="fa-solid fa-bullseye"></i>
            <span>MJS Post Navi</span>
        </div>
        
        <!-- å³ç«¯ï¼šè¨­å®šãƒœã‚¿ãƒ³ -->
        <div class="header-actions">
            <!-- ä½¿ã„æ–¹ãƒœã‚¿ãƒ³è¿½åŠ  -->
            <button class="btn" onclick="openHowto()"><i class="fa-solid fa-circle-question"></i></button>
            <button class="btn" onclick="openSettings()"><i class="fa-solid fa-gear"></i></button>
        </div>
    </header>
    <div class="header-spacer"></div>

    <!-- Main Content -->
    <main class="container">
        
        <!-- Tabs -->
        <nav class="tabs">
            <button class="tab-btn active" onclick="switchTab('month')">æœˆåˆ¥</button>
            <button class="tab-btn" onclick="switchTab('event')">è¡Œäº‹</button>
            <button class="tab-btn" onclick="switchTab('weather')">å¤©å€™</button>
        </nav>

        <!-- Input Area -->
        <section id="input-area" class="card">
            
            <!-- Dynamic Tab Content -->
            <div id="tab-month" class="form-group tab-content">
                <label class="form-label"><i class="fa-regular fa-calendar"></i> å¯¾è±¡æœˆ</label>
                <select id="input-month" class="input-control">
                    <option value="" disabled selected>é¸æŠã—ã¦ãã ã•ã„</option>
                    <script>
                        for(let i=1; i<=12; i++) document.write(`<option value="${i}">${i}æœˆ</option>`);
                    </script>
                </select>
            </div>

            <div id="tab-event" class="form-group tab-content" style="display:none;">
                <label class="form-label"><i class="fa-solid fa-champagne-glasses"></i> è¡Œäº‹ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ</label>
                <select id="input-event" class="input-control" onchange="checkCustomEvent(this)">
                    <option value="" disabled selected>é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢" style="color:#A62C2B; font-weight:bold;">â˜…ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢</option>
                    <option value="ç¥æ—¥">ç¥æ—¥ãƒ»é€£ä¼‘</option>
                    <option value="èª•ç”Ÿæ—¥">èª•ç”Ÿæ—¥ãƒ»è¨˜å¿µæ—¥</option>
                    <option value="æ­“è¿ä¼š">æ­“è¿ä¼š</option>
                    <option value="é€åˆ¥ä¼š">é€åˆ¥ä¼š</option>
                    <option value="å¿˜å¹´ä¼š">å¿˜å¹´ä¼š</option>
                    <option value="æ–°å¹´ä¼š">æ–°å¹´ä¼š</option>
                    <option value="custom">è‡ªç”±å…¥åŠ›...</option>
                </select>
                <input type="text" id="input-event-custom" class="input-control" placeholder="ä¾‹ï¼šå‘¨å¹´ã‚¤ãƒ™ãƒ³ãƒˆ" style="display:none; margin-top:10px;">
            </div>

            <div id="tab-weather" class="form-group tab-content" style="display:none;">
                <label class="form-label"><i class="fa-solid fa-cloud-sun"></i> ä»Šæ—¥ã®å¤©æ°—</label>
                <select id="input-weather" class="input-control">
                    <option value="" disabled selected>é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="æ™´ã‚Œ">æ™´ã‚Œ</option>
                    <option value="é›¨">é›¨</option>
                    <option value="æš‘ã„">æš‘ã„</option>
                    <option value="å¯’ã„">å¯’ã„</option>
                    <option value="å¼·é¢¨">é¢¨ãŒå¼·ã„</option>
                </select>
            </div>

            <!-- Common Inputs -->
            <div class="form-group">
                <label class="form-label"><i class="fa-solid fa-store"></i> åº—èˆ—ã‚¿ã‚¤ãƒ—</label>
                <select id="input-store-type" class="input-control">
                    <option value="bar">ãƒãƒ¼</option>
                    <option value="izakaya">å±…é…’å±‹</option>
                    <option value="dining">ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒãƒ¼</option>
                    <option value="cafe">ã‚«ãƒ•ã‚§ãƒãƒ¼</option>
                    <option value="other">ãã®ä»–</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label"><i class="fa-solid fa-share-nodes"></i> æŠ•ç¨¿å…ˆ</label>
                <select id="input-platform" class="input-control">
                    <option value="instagram">Instagram</option>
                    <option value="facebook">Facebook</option>
                    <option value="x">X (Twitter)</option>
                    <option value="line">LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</option>
                    <option value="gmap">Googleãƒãƒƒãƒ—</option>
                </select>
            </div>

            <div style="display:flex; gap:12px;">
                <div class="form-group" style="flex:1;">
                    <label class="form-label">ãƒˆãƒ¼ãƒ³</label>
                    <select id="input-tone" class="input-control">
                        <option value="lively">ã«ãã‚„ã‹</option>
                        <option value="gentle">ã‚„ã•ã—ã„</option>
                        <option value="adult">å¤§äºº</option>
                        <option value="frank">ãƒ•ãƒ©ãƒ³ã‚¯</option>
                    </select>
                </div>
                <div class="form-group" style="flex:1;">
                    <label class="form-label">çµµæ–‡å­—</label>
                    <select id="input-emoji" class="input-control">
                        <option value="high">å¤šã‚</option>
                        <option value="medium" selected>ã»ã©ã»ã©</option>
                        <option value="low">å°‘ãªã‚</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label"><i class="fa-solid fa-bullseye" style="color:var(--primary);"></i> ãƒ€ãƒ¼ãƒ„ã®å‡ºã—æ–¹</label>
                <select id="input-darts" class="input-control">
                    <option value="front">å‰é¢ã«å‡ºã™ï¼ˆå‹è² ãƒ»ç››ã‚Šä¸ŠãŒã‚Šï¼‰</option>
                    <option value="subtle" selected>ã•ã‚Šã’ãªãï¼ˆä¼šè©±ã®ãã£ã‹ã‘ï¼‰</option>
                    <option value="none">ä»Šæ—¥ã¯å‡ºã•ãªã„</option>
                </select>
            </div>

            <button class="btn generate-btn" onclick="generatePost()">
                <i class="fa-solid fa-wand-magic-sparkles"></i> æŠ•ç¨¿ã‚’ã¤ãã‚‹
            </button>
        </section>

        <!-- Output Area -->
        <section id="output-area" class="card">
            <h3 style="margin-top:0; font-size:1.1rem; color:var(--primary); border-bottom:1px solid var(--border-color); padding-bottom:12px; margin-bottom:16px;">
                <i class="fa-solid fa-pen-nib"></i> ç”Ÿæˆã•ã‚ŒãŸæŠ•ç¨¿
            </h3>
            
            <!-- æŠ•ç¨¿æ–‡è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="output-text" class="result-text" contenteditable="true"></div>
            
            <!-- ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ç›´ä¸‹ï¼‰ -->
            <div class="copy-action-area">
                <button class="copy-btn-full" onclick="copyToClipboard()">
                    <i class="fa-regular fa-copy"></i> æŠ•ç¨¿æ–‡ã‚’ã™ã¹ã¦ã‚³ãƒ”ãƒ¼
                </button>
            </div>

            <!-- ãƒ—ãƒ­ç´šæ’®å½±ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ï¼ˆå†™çœŸ/å‹•ç”»ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼‰ -->
            <div class="form-label" style="margin-top:10px;">
                ãƒ—ãƒ­ç´šæ’®å½±ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ <span style="font-weight:normal; font-size:0.75rem; color:var(--primary); border:1px solid var(--primary); padding:2px 6px; border-radius:4px; margin-left:8px;">PREMIUM</span>
            </div>

            <div class="sub-tabs">
                <button class="sub-tab-btn active" onclick="switchTipsTab('photo')"><i class="fa-solid fa-camera"></i> å†™çœŸ</button>
                <button class="sub-tab-btn" onclick="switchTipsTab('video')"><i class="fa-solid fa-video"></i> å‹•ç”»</button>
            </div>

            <div id="tips-content-photo" class="photo-suggestions">
                <!-- JS inserted (Photo) -->
            </div>
            <div id="tips-content-video" class="photo-suggestions" style="display:none;">
                <!-- JS inserted (Video) -->
            </div>

        </section>

        <!-- History Area -->
        <section class="history-section">
            <div class="history-title">
                <span>æœ€è¿‘ä½œã£ãŸæŠ•ç¨¿</span>
                <span onclick="clearData()" style="font-size:0.75rem; color:var(--primary); cursor:pointer;">å±¥æ­´ã‚¯ãƒªã‚¢</span>
            </div>
            <div class="history-list" id="history-list">
                <div style="padding:10px; color:var(--text-sub); font-size:0.8rem;">å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="app-footer">
        ãƒ†ã‚¹ãƒˆç‰ˆï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆï¼‰ Â© 2026 SPC
    </footer>

    <!-- Help FAB -->
    <button class="help-fab" onclick="showToast('å³ä¸Šã®æ­¯è»Šã‹ã‚‰è¨­å®šã‚’è¡Œãˆã¾ã™')">?</button>

    <!-- Howto Modal (New) -->
    <div id="howto-modal" class="modal-overlay" onclick="if(event.target === this) closeHowto()">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fa-solid fa-book-open"></i> ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</div>
                <button class="close-btn" onclick="closeHowto()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div style="padding: 24px; overflow-y: auto;">
                <div class="setting-section-title">ã“ã®ã‚¢ãƒ—ãƒªã®ç›®çš„</div>
                <ul style="padding-left: 20px; color: var(--text-main); font-size: 0.9rem; margin-bottom: 24px; line-height: 1.8;">
                    <li>SNSæŠ•ç¨¿ã§ã€Œä½•ã‚’æ›¸ã“ã†â€¦ã€ã¨è¿·ã†æ™‚é–“ã‚’æ¸›ã‚‰ã™ãŸã‚ã®ãƒŠãƒ“ã§ã™</li>
                    <li>æœˆãƒ»è¡Œäº‹ãƒ»å¤©å€™ã‹ã‚‰ã€ä»Šæ—¥ã«åˆã†æŠ•ç¨¿ã‚’ã™ãä½œã‚Œã¾ã™</li>
                    <li>å£²ã‚Šè¾¼ã¿ã™ããªã„ã€è‡ªç„¶ãªãƒ€ãƒ¼ãƒ„æŠ•ç¨¿ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™</li>
                </ul>

                <div class="setting-section-title">æŠ•ç¨¿ã¾ã§ã®æµã‚Œ</div>
                <ol style="padding-left: 20px; color: var(--text-main); font-size: 0.9rem; margin-bottom: 24px; line-height: 1.8;">
                    <li>æœˆåˆ¥ãƒ»è¡Œäº‹ãƒ»å¤©å€™ã‹ã‚‰ã€ä»Šæ—¥ã®åˆ‡ã‚Šå£ã‚’é¸ã¶</li>
                    <li>ãŠåº—ã®é›°å›²æ°—ã‚„æŠ•ç¨¿å…ˆã‚’é¸ã¶</li>
                    <li>ãƒ€ãƒ¼ãƒ„ã®å‡ºã—æ–¹ã‚’æ±ºã‚ã¦ã€ŒæŠ•ç¨¿ã‚’ã¤ãã‚‹ã€ã‚’æŠ¼ã™</li>
                </ol>

                <div style="font-size: 0.8rem; color: var(--text-sub); background: var(--input-bg); padding: 12px; border-radius: 8px;">
                    <div>â€» æ–‡ç« ã¯ç”Ÿæˆå¾Œã«è‡ªç”±ã«æ›¸ãæ›ãˆã§ãã¾ã™</div>
                    <div style="margin-top: 4px;">â€» å†™çœŸãƒ»å‹•ç”»ã®æ’®ã‚Šæ–¹ãƒ’ãƒ³ãƒˆã‚‚ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="btn generate-btn" onclick="closeHowto()">é–‰ã˜ã‚‹</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fa-solid fa-gear"></i> è¨­å®š</div>
                <button class="close-btn" onclick="closeSettings()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div style="overflow-y: auto; flex:1;">
                
                <!-- Section 1: App Settings -->
                <div class="setting-section">
                    <div class="setting-section-title">ã‚¢ãƒ—ãƒªè¨­å®š</div>
                    <div class="form-group" style="display:flex; justify-content:space-between; align-items:center;">
                        <label>ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="setting-theme" onchange="toggleTheme()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Section 2: MJS Link Settings (User Editable) -->
                <div class="setting-section">
                    <div class="setting-section-title">MJSãƒªãƒ³ã‚¯è¨­å®šï¼ˆURLã‚’å…¥åŠ›ï¼‰</div>
                    
                    <div class="form-group">
                        <label class="form-label" style="font-size:0.8rem;">MJSã‚µã‚¤ãƒˆ URL</label>
                        <input type="url" id="setting-mjs-site" class="input-control" placeholder="https://..." style="padding:10px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="font-size:0.8rem;">è¦‹ã¦ã»ã—ã„ã‚µã‚¤ãƒˆï¼ˆå°å…¥äº‹ä¾‹ãªã©ï¼‰</label>
                        <input type="url" id="setting-mjs-case" class="input-control" placeholder="https://..." style="padding:10px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="font-size:0.8rem;">å…¬å¼LINEã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</label>
                        <input type="url" id="setting-mjs-line" class="input-control" placeholder="https://..." style="padding:10px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="font-size:0.8rem;">Googleãƒãƒƒãƒ—å…±æœ‰URL</label>
                        <input type="url" id="setting-mjs-map" class="input-control" placeholder="https://..." style="padding:10px;">
                    </div>
                </div>

                <!-- Section 3: Data Controls -->
                <div class="setting-section" style="border-bottom:none;">
                    <div class="setting-section-title">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
                    <button class="btn" style="width:100%; border:1px solid var(--border-color); color:var(--text-sub); margin-bottom:10px;" onclick="fillDemoData(); closeSettings();">
                        ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹
                    </button>
                </div>

                <div style="padding:24px;">
                    <button class="btn generate-btn" onclick="saveSettings(); closeSettings(); showToast('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');">ä¿å­˜ã™ã‚‹</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fa-solid fa-circle-check" style="color:var(--gold);"></i> <span id="toast-msg">Copied!</span>
    </div>

    <!-- Logic -->
    <script>
        // State
        let currentTab = 'month';
        let historyData = [];

        // Data Dictionaries
        const phraseBook = {
            weather: {
                'æ™´ã‚Œ': ['æ°—æŒã¡ã®ã„ã„æ™´ã‚Œæ¨¡æ§˜ã§ã™ã­ï¼â˜€', 'ä»Šæ—¥ã¯çµ¶å¥½ã®é£²ã¿æ—¥å’Œã€‚', 'æ˜ŸãŒç¶ºéº—ãªå¤œã«ãªã‚Šãã†ã§ã™ã€‚'],
                'é›¨': ['ã‚ã„ã«ãã®é›¨ã§ã™ãŒã€åº—å†…ã¯å¿«é©ã§ã™ã€‚â˜”', 'é›¨éŸ³ã‚’èããªãŒã‚‰ã—ã£ã½ã‚Šã¨ã€‚', 'è¶³å…ƒã®æ‚ªã„ä¸­ã§ã™ãŒã€é›¨å®¿ã‚Šã«ã©ã†ãã€‚'],
                'æš‘ã„': ['ä»Šæ—¥ã‚‚æš‘ã„ã§ã™ã­ï¼ã‚­ãƒ³ã‚­ãƒ³ã«å†·ãˆã¦ã¾ã™ã€‚ğŸº', 'ç†±å¸¯å¤œã«ã¯å†·ãŸã„ä¸€æ¯ã‚’ã€‚', 'æš‘ã•ã‚’å¹ãé£›ã°ã™ä¸€æ¯ã€ç”¨æ„ã—ã¦ã¾ã™ã€‚'],
                'å¯’ã„': ['å†·ãˆè¾¼ã‚€å¤œã¯ã€æš–ã‹ãã—ã¦ãŠå¾…ã¡ã—ã¦ã¾ã™ã€‚â˜ƒï¸', 'å¯’ã•ã§è‚©ãŒç¸®ã“ã¾ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ', 'å¿ƒã‚‚ä½“ã‚‚æ¸©ã¾ã‚‹å ´æ‰€ã€ã“ã“ã«ã‚ã‚Šã¾ã™ã€‚'],
                'å¼·é¢¨': ['é¢¨ãŒå¼·ã„ã®ã§ã€æ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„ã­ã€‚', 'å¤–ã¯å¼·é¢¨ã§ã™ãŒã€ä¸­ã¯ç©ã‚„ã‹ãªæ™‚é–“æµã‚Œã¦ã¾ã™ã€‚']
            },
            vibe: {
                lively: ['ä»Šå¤œã¯ãƒ‘ãƒƒã¨ç››ã‚Šä¸ŠãŒã‚Šã¾ã—ã‚‡ã†ï¼', 'ãƒ¯ã‚¤ãƒ¯ã‚¤æ¥½ã—ã‚€ãªã‚‰å½“åº—ã¸ï¼', 'ã‚¨ãƒŠã‚¸ãƒ¼ãƒãƒ£ãƒ¼ã‚¸ã§ãã‚‹ç©ºé–“ã§ã™ã€‚'],
                gentle: ['ã»ã£ã¨ä¸€æ¯ã€ã¤ãã¾ã›ã‚“ã‹ï¼Ÿ', 'ç–²ã‚Œã‚’ç™’ã‚„ã™å„ªã—ã„æ™‚é–“ã€‚', 'ã‚ãªãŸã®å±…å ´æ‰€ã‚’ã”ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚'],
                adult:  ['å¤§äººã®éš ã‚Œå®¶ã§ã€ä¸Šè³ªãªæ™‚é–“ã‚’ã€‚', 'ã‚°ãƒ©ã‚¹ã‚’å‚¾ã‘ã‚‹ã€è´…æ²¢ãªã²ã¨ã¨ãã€‚', 'é™ã‹ã«æµã‚Œã‚‹å¤œã‚’æ¥½ã—ã‚€ãªã‚‰ã€‚'],
                frank:  ['æ°—è»½ã«ä¸€æ¯ã€å¯„ã£ã¦ã£ã¦ï¼', 'ã‚¹ã‚¿ãƒƒãƒ•ä¸€åŒã€å…ƒæ°—ã«ãŠå¾…ã¡ã—ã¦ã¾ã™ï¼', 'ã‚µã‚¯ãƒƒã¨é£²ã¿ãŸã„æ™‚ã«ã‚‚ãŠã™ã™ã‚ã€‚']
            },
            darts: {
                front: {
                    lively: 'ğŸ¯ ä»Šæ—¥ã¯ãƒ€ãƒ¼ãƒ„ã§ã‚¬ãƒƒãƒ„ãƒªå‹è² ï¼è² ã‘ãŸäººãŒä¸€æ¯ãŠã”ã‚Šï¼Ÿç››ã‚Šä¸ŠãŒã‚‹ã“ã¨é–“é•ã„ãªã—ï¼',
                    gentle: 'ğŸ¯ ãƒ€ãƒ¼ãƒ„ã§è»½ãä½“ã‚’å‹•ã‹ã—ã¦ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¾ã›ã‚“ã‹ï¼Ÿåˆå¿ƒè€…ã®æ–¹ã‚‚å¤§æ­“è¿ã§ã™ã€‚',
                    adult:  'ğŸ¯ ã‚°ãƒ©ã‚¹ç‰‡æ‰‹ã«ãƒ€ãƒ¼ãƒ„ã‚’ä¸€æŠ•ã€‚å¤§äººã®éŠã³å¿ƒãŒã€å¤œã‚’å½©ã‚Šã¾ã™ã€‚',
                    frank:  'ğŸ¯ ãƒ€ãƒ¼ãƒ„ã‚ã‚‹ã‚ˆï¼ã¿ã‚“ãªã§ãƒ¯ã‚¤ãƒ¯ã‚¤æŠ•ã’ã‚ˆã†ãœï¼'
                },
                subtle: {
                    lively: 'ä¼šè©±ãŒå¼¾ã‚“ã ã‚‰ã€ã¡ã‚‡ã£ã¨ãƒ€ãƒ¼ãƒ„ã‚‚ã„ã„ã‹ã‚‚ã€‚',
                    gentle: 'ãŠè©±ã®åˆé–“ã«ã€1ã‚²ãƒ¼ãƒ ã ã‘æŠ•ã’ã‚‹ã®ã‚‚ç²‹ãªæ™‚é–“ã€‚',
                    adult:  'èƒŒæ™¯ã«ãƒ€ãƒ¼ãƒ„ã®éŸ³ã€‚ãã‚Œã‚‚ã¾ãŸã€ãƒãƒ¼ã®BGMã€‚',
                    frank:  'ãƒ€ãƒ¼ãƒ„ã‚‚ã‚ã‚‹ã‹ã‚‰ã€æ°—ãŒå‘ã„ãŸã‚‰æŠ•ã’ã¦ã¿ã¦ã­ã€‚'
                }
            }
        };

        const hashtags = {
            bar: '#ãƒãƒ¼ #Bar #ã‚«ã‚¯ãƒ†ãƒ«',
            izakaya: '#å±…é…’å±‹ #é£²ã¿ä¼š #ãŠã¤ã¾ã¿',
            dining: '#ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒãƒ¼ #ãƒ‡ã‚£ãƒŠãƒ¼ #å¥³å­ä¼š',
            cafe: '#ã‚«ãƒ•ã‚§ãƒãƒ¼ #å¤œã‚«ãƒ•ã‚§ #äºŒæ¬¡ä¼š',
            other: '#é£²é£Ÿåº— #ã‚°ãƒ«ãƒ¡ #å¤œã”é£¯'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            loadHistory();
            
            // Set default month
            const today = new Date();
            document.getElementById('input-month').value = today.getMonth() + 1;
        });

        // Tab Switching
        function switchTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            document.getElementById(`tab-${tabName}`).style.display = 'block';
        }

        // Custom Event Toggle
        function checkCustomEvent(select) {
            const customInput = document.getElementById('input-event-custom');
            customInput.style.display = select.value === 'custom' ? 'block' : 'none';
        }

        // --- Core Logic: Generate Post ---
        function generatePost() {
            // Get Values
            const storeType = document.getElementById('input-store-type').value;
            const platform = document.getElementById('input-platform').value;
            const tone = document.getElementById('input-tone').value;
            const emojiDensity = document.getElementById('input-emoji').value;
            const dartsMode = document.getElementById('input-darts').value;
            
            // Validate specific tab inputs
            let contextText = "";
            let contextType = ""; // for storing context
            
            if (currentTab === 'month') {
                const month = document.getElementById('input-month').value;
                if (!month) return showError('æœˆã‚’é¸æŠã—ã¦ãã ã•ã„');
                contextText = `${month}æœˆã§ã™ã­ã€‚å­£ç¯€ã®å¤‰ã‚ã‚Šç›®ã€ã„ã‹ãŒãŠéã”ã—ã§ã™ã‹ï¼Ÿ`;
                contextType = `${month}æœˆã®æŠ•ç¨¿`;
            } else if (currentTab === 'event') {
                let evt = document.getElementById('input-event').value;
                if (evt === 'custom') evt = document.getElementById('input-event-custom').value;
                if (!evt) return showError('è¡Œäº‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                
                if (evt === 'ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢') {
                    contextText = `ğŸ¯ ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢é–‹å‚¬ä¸­ï¼\nä»Šãªã‚‰ç‰¹åˆ¥ãªä½“é¨“ãŒå¾…ã£ã¦ã„ã¾ã™ã€‚\nåˆå¿ƒè€…ã®æ–¹ã‚‚ã€è…•ã«è‡ªä¿¡ãŒã‚ã‚‹æ–¹ã‚‚å¤§æ­“è¿ï¼`;
                    contextType = 'ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢';
                } else {
                    contextText = `${evt}ã®ã‚·ãƒ¼ã‚ºãƒ³åˆ°æ¥ï¼äºˆå®šã¯ã‚‚ã†æ±ºã¾ã‚Šã¾ã—ãŸã‹ï¼Ÿ`;
                    contextType = evt;
                }
            } else if (currentTab === 'weather') {
                const weather = document.getElementById('input-weather').value;
                if (!weather) return showError('å¤©æ°—ã‚’é¸æŠã—ã¦ãã ã•ã„');
                contextText = getRandom(phraseBook.weather[weather]) || 'ä»Šæ—¥ã‚‚ãŠç–²ã‚Œæ§˜ã§ã™ã€‚';
                contextType = weather;
            }

            // Build Parts
            const vibeText = getRandom(phraseBook.vibe[tone]);
            
            let dartsText = "";
            if (dartsMode !== 'none') {
                dartsText = phraseBook.darts[dartsMode][tone] || "";
            }
            
            // Darts Fair Special Override
            if (contextType === 'ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢') {
                dartsText = "æŠ•ã’æ”¾é¡Œãƒ—ãƒ©ãƒ³ã‚„ã€ãƒã‚¤ã‚¹ã‚³ã‚¢ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚‚å®Ÿæ–½ä¸­ï¼ã¿ã‚“ãªã§ç››ã‚Šä¸ŠãŒã‚Šã¾ã—ã‚‡ã†ï¼";
            }

            // Assemble Text
            let fullText = "";
            
            // Adjust format by platform
            if (platform === 'instagram') {
                fullText = `${contextText}\n\n${vibeText}\n\n${dartsText ? dartsText + '\n\n' : ''}ãŠã„ã—ã„ãŠé…’ã¨ç©ºé–“ã‚’ã”ç”¨æ„ã—ã¦ã€\nãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™âœ¨\n\n`;
            } else if (platform === 'line') {
                fullText = `${contextText}\n${vibeText}\n${dartsText}\n\nãŠå¾…ã¡ã—ã¦ã¾ã™ï¼`;
            } else if (platform === 'gmap') {
                fullText = `${contextText} ${vibeText}\n\n${dartsText ? dartsText + '\n' : ''}è¿‘ãã«ãŠè¶Šã—ã®éš›ã¯ãœã²ãŠç«‹ã¡å¯„ã‚Šãã ã•ã„ã€‚`;
            } else {
                // Facebook/Default
                fullText = `${contextText}\n${vibeText}\n\n${dartsText ? dartsText + '\n' : ''}çš†æ§˜ã®ã”æ¥åº—ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚`;
            }

            // Apply Emoji Density
            fullText = applyEmoji(fullText, emojiDensity, tone);

            // Generate Hashtags
            let tags = hashtags[storeType] || '#é£²é£Ÿåº—';
            if (dartsMode !== 'none' || contextType === 'ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢') tags += ' #ãƒ€ãƒ¼ãƒ„ #Darts #ãƒ€ãƒ¼ãƒ„ãƒãƒ¼';
            if (currentTab === 'month') tags += ` #${document.getElementById('input-month').value}æœˆ`;
            if (tone === 'adult') tags += ' #éš ã‚Œå®¶ #ãƒ‡ãƒ¼ãƒˆ';
            if (tone === 'lively') tags += ' #äºŒæ¬¡ä¼š #ãƒ‘ãƒ¼ãƒ†ã‚£';

            // Add tags to full text
            fullText += `\n\n${tags}`;

            // --- MJS Promotion Logic (Dynamic URLs from Settings) ---
            const mjsSite = document.getElementById('setting-mjs-site').value;
            const mjsLine = document.getElementById('setting-mjs-line').value;
            
            // æ¡ä»¶ã‚’ç·©å’Œ
            if (dartsMode !== 'none' || contextType === 'ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢') {
                if (mjsSite || mjsLine) {
                    fullText += `\n\n----------------\nğŸ¯ ãƒ€ãƒ¼ãƒ„ãƒã‚·ãƒ³å°å…¥ã«ã¤ã„ã¦`;
                    
                    if (platform === 'instagram') {
                        fullText += `\n\næ°—ã«ãªã£ãŸæ–¹ã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã€\nã¾ãŸã¯WEBã§ã€ŒMJS ãƒ€ãƒ¼ãƒ„ã€ã¨æ¤œç´¢ã—ã¦ãã ã•ã„ğŸ”`;
                    } else {
                        if (mjsSite) fullText += `\n\nğŸŒ MJSå…¬å¼ã‚µã‚¤ãƒˆ\n${mjsSite}`;
                        if (mjsLine) fullText += `\n\nğŸ’¬ ã”ç›¸è«‡ã¯LINEã‹ã‚‰\n${mjsLine}`;
                    }
                }
            }

            // --- Photo Suggestions (Premium Tips) ---
            const photoIdeas = [];

            // 1. Inverse Smartphone
            photoIdeas.push({
                icon: 'fa-mobile-screen-button',
                title: 'è£æŠ€ï¼šã€Œé€†ã•ã‚¹ãƒãƒ›ã€ã§è¿«åŠ›ã‚’å‡ºã™',
                desc: `
                    <ul>
                        <li>ã‚¹ãƒãƒ›ã‚’é€†ã•ã¾ã«æŒã¡æ›¿ãˆã‚‹</li>
                        <li>ã‚«ãƒ¡ãƒ©ãƒ¬ãƒ³ã‚ºã‚’ãƒ†ãƒ¼ãƒ–ãƒ«é¢ã‚¹ãƒ¬ã‚¹ãƒ¬ã«é…ç½®</li>
                        <li>å°‘ã—ä¸Šå‘ãï¼ˆã‚¢ã‚ªãƒªï¼‰ã§ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã‚’åˆ‡ã‚‹</li>
                    </ul>
                    <div class="photo-chip-point"><i class="fa-regular fa-lightbulb"></i> å¤©äº•ãŒé«˜ãæ˜ ã‚Šã€ãƒ‰ãƒªãƒ³ã‚¯ã‚„æ–™ç†ãŒå¡”ã®ã‚ˆã†ã«ç«‹æ´¾ã«è¦‹ãˆã¾ã™ï¼</div>`
            });

            // 2. Zoom 2x
            photoIdeas.push({
                icon: 'fa-magnifying-glass-plus',
                title: 'åŸºæœ¬ï¼šã€Œ2å€ã‚ºãƒ¼ãƒ ã€ã§å½¢ã‚’æ•´ãˆã‚‹',
                desc: `
                    <ul>
                        <li>ã‚¹ãƒãƒ›ã®æ¨™æº–ï¼ˆ1xï¼‰ã§ã¯ãªãã€Œ2xã€ã‹ã€Œ3xã€ã«ã™ã‚‹</li>
                        <li>ãã®åˆ†ã€è¢«å†™ä½“ã‹ã‚‰å°‘ã—é›¢ã‚Œã¦æ’®å½±ã™ã‚‹</li>
                    </ul>
                    <div class="photo-chip-point"><i class="fa-regular fa-lightbulb"></i> ã‚°ãƒ©ã‚¹ã‚„çš¿ã®æ­ªã¿ãŒãªããªã‚Šã€ãƒ—ãƒ­ãŒä¸€çœ¼ãƒ¬ãƒ•ã§æ’®ã£ãŸã‚ˆã†ãªç«¯æ­£ãªå½¢ã«ãªã‚Šã¾ã™ã€‚</div>`
            });

            // 3. Context specific (Photo)
            if (dartsMode !== 'none' || contextType === 'ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢') {
                photoIdeas.push({
                    icon: 'fa-bullseye',
                    title: 'æ§‹å›³ï¼šã€Œå‰ãƒœã‚±ã€ã§è³‘ã‚ã„ã‚’æ¼”å‡º',
                    desc: `
                        <ul>
                            <li>æ‰‹å‰ã«ã€Œèª°ã‹ã®è‚©ã€ã‚„ã€Œã‚°ãƒ©ã‚¹ã€ã‚’å°‘ã—è¦‹åˆ‡ã‚Œã•ã›ã‚‹</li>
                            <li>å¥¥ã®ãƒ€ãƒ¼ãƒ„ç›¤ã«ãƒ”ãƒ³ãƒˆã‚’å›ºå®šï¼ˆç”»é¢é•·æŠ¼ã—ï¼‰ã™ã‚‹</li>
                            <li>ã‚ãˆã¦æ‰‹å‰ã‚’ãƒœã‚«ã—ã¦æ’®å½±</li>
                        </ul>
                        <div class="photo-chip-point"><i class="fa-regular fa-lightbulb"></i> ã€Œç›—ã¿æ’®ã‚Šã€ã®ã‚ˆã†ãªè‡ªç„¶ãªã‚¢ãƒ³ã‚°ãƒ«ã«ãªã‚Šã€ãã®å ´ã®è‡¨å ´æ„ŸãŒä¼ã‚ã‚Šã¾ã™ã€‚</div>`
                });
            } else {
                photoIdeas.push({
                    icon: 'fa-utensils',
                    title: 'ç…§æ˜ï¼šã€Œæ–œã‚é€†å…‰ã€ã§ã‚·ã‚ºãƒ«æ„Ÿã‚’',
                    desc: `
                        <ul>
                            <li>åº—å†…ã®ç…§æ˜ãŒã€æ–™ç†ã®ã€Œæ–œã‚å¾Œã‚ã€ã«æ¥ã‚‹å¸­ã‚’é¸ã¶</li>
                            <li>ã¾ãŸã¯ã€å‹äººã®ã‚¹ãƒãƒ›ãƒ©ã‚¤ãƒˆã‚’æ–œã‚å¾Œã‚ã‹ã‚‰å½“ã¦ã¦ã‚‚ã‚‰ã†</li>
                            <li>éœ²å‡ºï¼ˆæ˜ã‚‹ã•ï¼‰ã‚’å°‘ã—ä¸‹ã’ã¦æ’®å½±</li>
                        </ul>
                        <div class="photo-chip-point"><i class="fa-regular fa-lightbulb"></i> è¡¨é¢ã®ãƒ†ã‚«ãƒªã‚„æ¹¯æ°—ãŒå¼·èª¿ã•ã‚Œã€åœ§å€’çš„ã«ç¾å‘³ã—ãã†ã«æ’®ã‚Œã¾ã™ã€‚</div>`
                });
            }

            // --- Video Suggestions (Premium Tips) ---
            const videoIdeas = [];

            // 1. Pan (Space)
            videoIdeas.push({
                icon: 'fa-video',
                title: 'å‹•ç”»ï¼šã€Œã‚†ã£ãã‚Šãƒ‘ãƒ³ã€ã§ç©ºé–“ç´¹ä»‹',
                desc: `
                    <ul>
                        <li>è„‡ã‚’ç· ã‚ã¦ã‚¹ãƒãƒ›ã‚’ä¸¡æ‰‹ã§æŒã¤</li>
                        <li>ä½“ã”ã¨ã‚†ã£ãã‚Šæ¨ªã«å›è»¢ã™ã‚‹ï¼ˆè¶³ã¯å‹•ã‹ã•ãªã„ï¼‰</li>
                        <li>ã€Œé…ã™ãã‚‹ã‹ãªï¼Ÿã€ã¨æ€ã†ãã‚‰ã„ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã§</li>
                    </ul>
                    <div class="photo-chip-point"><i class="fa-regular fa-lightbulb"></i> åº—å†…ã®åºƒãŒã‚Šã‚„é›°å›²æ°—ãŒä¼ã‚ã‚Šã¾ã™ã€‚æ‰‹ãƒ–ãƒ¬è£œæ­£ã¯å¿…ãšONã«ï¼</div>`
            });

            // 2. Sizzle (Food/Drink)
            videoIdeas.push({
                icon: 'fa-glass-water',
                title: 'å‹•ç”»ï¼šã€Œã‚·ã‚ºãƒ«æ„Ÿã€ä¸€ç‚¹çªç ´',
                desc: `
                    <ul>
                        <li>ç‚­é…¸ãŒå¼¾ã‘ã‚‹æ§˜å­ã‚„ã€æ¹¯æ°—ãŒç«‹ã¤æ§˜å­ã‚’ã‚¢ãƒƒãƒ—ã§æ’®ã‚‹</li>
                        <li>ã‚¹ãƒãƒ›ã‚’å›ºå®šã—ã€çµ¶å¯¾ã«å‹•ã‹ã•ãªã„ï¼ˆãƒ•ã‚£ãƒƒã‚¯ã‚¹æ’®å½±ï¼‰</li>
                        <li>3ç§’ã€œ5ç§’ç¨‹åº¦ã®çŸ­å°ºã§OK</li>
                    </ul>
                    <div class="photo-chip-point"><i class="fa-regular fa-lightbulb"></i> ã€Œç¾å‘³ã—ãã†ï¼ã€ã¨ç›´æ„Ÿçš„ã«ä¼ã‚ã‚‹ã®ã¯ã€å®Ÿã¯å‹•ã‹ãªã„å›ºå®šå‹•ç”»ã§ã™ã€‚</div>`
            });

            // 3. Action (Darts/Cheers)
            if (dartsMode !== 'none' || contextType === 'ãƒ€ãƒ¼ãƒ„ãƒ•ã‚§ã‚¢') {
                videoIdeas.push({
                    icon: 'fa-bullseye',
                    title: 'å‹•ç”»ï¼šãƒ€ãƒ¼ãƒ„ãŒåˆºã•ã‚‹ã€ŒéŸ³ã€ã‚’æ’®ã‚‹',
                    desc: `
                        <ul>
                            <li>ãƒœãƒ¼ãƒ‰ã®è¿‘ãã‹ã‚‰ã€åˆºã•ã‚‹ç¬é–“ã‚’ç‹™ã†</li>
                            <li>ã€Œãƒˆãƒ³ãƒƒã€ã¨ã„ã†å¿ƒåœ°ã‚ˆã„éŸ³ã‚’åéŒ²ã™ã‚‹</li>
                            <li>æŠ•ã’ãŸäººã®æ­“å£°ã¾ã§å…¥ã‚Œã‚‹</li>
                        </ul>
                        <div class="photo-chip-point"><i class="fa-regular fa-lightbulb"></i> éŸ³ã¯æ˜ åƒä»¥ä¸Šã«ç¾å ´ã®ç†±é‡ã‚’ä¼ãˆã¾ã™ã€‚ãƒªãƒ¼ãƒ«å‹•ç”»ã«æœ€é©ã§ã™ã€‚</div>`
                });
            } else {
                videoIdeas.push({
                    icon: 'fa-mug-hot',
                    title: 'å‹•ç”»ï¼šã€Œæ¹¯æ°—/æ³¨ãã€ã®ç¬é–“',
                    desc: `
                        <ul>
                            <li>ãƒ‰ãƒªãƒ³ã‚¯ã‚’æ³¨ãã€ã‚½ãƒ¼ã‚¹ã‚’ã‹ã‘ã‚‹ç¬é–“ã‚’æ’®ã‚‹</li>
                            <li>ã‚¹ãƒ­ãƒ¼ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã¿ã‚‹</li>
                        </ul>
                        <div class="photo-chip-point"><i class="fa-regular fa-lightbulb"></i> å‹•ãã®ã‚ã‚‹æ˜ åƒã¯ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§æŒ‡ã‚’æ­¢ã‚ã•ã›ã‚‹åŠ¹æœçµ¶å¤§ã§ã™ã€‚</div>`
                });
            }


            // Render
            const outputArea = document.getElementById('output-area');
            document.getElementById('output-text').innerText = fullText;
            
            // Render Photo Tips
            const photoContainer = document.getElementById('tips-content-photo');
            photoContainer.innerHTML = photoIdeas.map(idea => `
                <div class="photo-chip">
                    <div class="photo-chip-header">
                        <i class="fa-solid ${idea.icon}"></i>
                        <span>${idea.title}</span>
                    </div>
                    <div class="photo-chip-desc">${idea.desc}</div>
                </div>
            `).join('');

            // Render Video Tips
            const videoContainer = document.getElementById('tips-content-video');
            videoContainer.innerHTML = videoIdeas.map(idea => `
                <div class="photo-chip">
                    <div class="photo-chip-header">
                        <i class="fa-solid ${idea.icon}"></i>
                        <span>${idea.title}</span>
                    </div>
                    <div class="photo-chip-desc">${idea.desc}</div>
                </div>
            `).join('');

            // Reset Tab to Photo
            switchTipsTab('photo');

            outputArea.style.display = 'block';
            outputArea.scrollIntoView({behavior: 'smooth', block: 'start'});

            // Save History
            saveHistoryToStorage({
                type: contextType,
                text: fullText,
                date: new Date().toLocaleString('ja-JP', {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'})
            });
        }

        // --- Tips Tab Switching ---
        function switchTipsTab(type) {
            const photoContent = document.getElementById('tips-content-photo');
            const videoContent = document.getElementById('tips-content-video');
            const buttons = document.querySelectorAll('.sub-tab-btn');

            if (type === 'photo') {
                photoContent.style.display = 'flex';
                videoContent.style.display = 'none';
                buttons[0].classList.add('active');
                buttons[1].classList.remove('active');
            } else {
                photoContent.style.display = 'none';
                videoContent.style.display = 'flex';
                buttons[0].classList.remove('active');
                buttons[1].classList.add('active');
            }
        }

        // --- Helper Functions ---
        
        function getRandom(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function applyEmoji(text, density, tone) {
            if (density === 'low') return text; // Minimal emojis already in text
            
            const emojis = ['âœ¨', 'ğŸ¸', 'ğŸ»', 'ğŸ½', 'ğŸŒ™', 'ğŸµ', 'ğŸ™Œ'];
            if (tone === 'adult') {
                 // Adult tone: fewer, classy emojis
                 if (density === 'high') text = text.replace(/\n/g, ' âœ¨\n');
            } else {
                // Lively/Gentle
                if (density === 'high') {
                    text = text.replace(/ã€‚/g, 'ï¼âœ¨');
                    text = text.replace(/\n/g, ' ğŸ˜Š\n');
                } else {
                    // Medium
                    text += ' ğŸ¥‚';
                }
            }
            return text;
        }

        // --- Clipboard ---
        function copyToClipboard() {
            let text = document.getElementById('output-text').innerText;

            // Use document.execCommand('copy') for better compatibility in iframes
            const ta = document.createElement('textarea');
            ta.value = text;
            ta.style.position = 'fixed'; // Avoid scrolling to bottom
            ta.style.opacity = '0';
            document.body.appendChild(ta);
            ta.select();
            try {
                document.execCommand('copy');
                showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            } catch (err) {
                console.error('Copy failed', err);
                showToast('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            document.body.removeChild(ta);
        }

        // --- UI Interactions ---
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function showError(msg) {
            showToast('âš ï¸ ' + msg);
        }

        function openSettings() {
            document.getElementById('settings-modal').classList.add('open');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.remove('open');
        }

        // New Howto functions
        function openHowto() {
            document.getElementById('howto-modal').classList.add('open');
        }

        function closeHowto() {
            document.getElementById('howto-modal').classList.remove('open');
        }

        function toggleTheme() {
            const isDark = document.getElementById('setting-theme').checked;
            document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
        }

        // --- Storage & History ---
        function saveSettings() {
            const settings = {
                theme: document.getElementById('setting-theme').checked,
                mjsSite: document.getElementById('setting-mjs-site').value,
                mjsCase: document.getElementById('setting-mjs-case').value,
                mjsLine: document.getElementById('setting-mjs-line').value,
                mjsMap: document.getElementById('setting-mjs-map').value
            };
            localStorage.setItem('mjs_settings', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('mjs_settings');
            if (saved) {
                const s = JSON.parse(saved);
                document.getElementById('setting-theme').checked = s.theme;
                
                document.getElementById('setting-mjs-site').value = s.mjsSite || '';
                document.getElementById('setting-mjs-case').value = s.mjsCase || '';
                document.getElementById('setting-mjs-line').value = s.mjsLine || '';
                document.getElementById('setting-mjs-map').value = s.mjsMap || '';

                if (s.theme) document.body.setAttribute('data-theme', 'dark');
            }
        }

        function saveHistoryToStorage(item) {
            historyData.unshift(item);
            if (historyData.length > 3) historyData.pop();
            localStorage.setItem('mjs_history', JSON.stringify(historyData));
            loadHistory(); // Re-render
        }

        function loadHistory() {
            const saved = localStorage.getItem('mjs_history');
            const list = document.getElementById('history-list');
            list.innerHTML = '';

            if (saved) {
                historyData = JSON.parse(saved);
                if (historyData.length === 0) {
                    list.innerHTML = '<div style="padding:10px; color:var(--text-sub); font-size:0.8rem;">å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                    return;
                }
                
                historyData.forEach(h => {
                    const card = document.createElement('div');
                    card.className = 'history-card';
                    card.onclick = () => {
                        document.getElementById('output-text').innerText = h.text;
                        document.getElementById('output-area').style.display = 'block';
                        document.getElementById('output-area').scrollIntoView({behavior:'smooth'});
                    };
                    card.innerHTML = `
                        <div class="history-content">${h.text}</div>
                        <div class="history-date">${h.type} â€¢ ${h.date}</div>
                    `;
                    list.appendChild(card);
                });
            } else {
                 list.innerHTML = '<div style="padding:10px; color:var(--text-sub); font-size:0.8rem;">å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
            }
        }

        function fillDemoData() {
            // åº—èˆ—æƒ…å ±ã®ãƒ‡ãƒ¢
            document.getElementById('input-store-type').value = 'bar';
            document.getElementById('input-platform').value = 'instagram';
            document.getElementById('input-tone').value = 'adult';
            document.getElementById('input-emoji').value = 'medium';
            document.getElementById('input-darts').value = 'subtle';
            
            if (currentTab === 'month') document.getElementById('input-month').value = '12';
            if (currentTab === 'event') {
                document.getElementById('input-event').value = 'custom';
                checkCustomEvent(document.getElementById('input-event'));
                document.getElementById('input-event-custom').value = '3å‘¨å¹´è¨˜å¿µ';
            }
            if (currentTab === 'weather') document.getElementById('input-weather').value = 'é›¨';

            // MJSãƒªãƒ³ã‚¯ã®ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿
            document.getElementById('setting-mjs-site').value = 'https://www.mjs-darts.com/';
            document.getElementById('setting-mjs-case').value = 'https://www.mjs-darts.com/case/';
            document.getElementById('setting-mjs-line').value = 'https://line.me/R/ti/p/@mjs';
            document.getElementById('setting-mjs-map').value = 'https://maps.app.goo.gl/dummy';

            showToast('ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¾ã—ãŸ');
        }

        function clearData() {
            localStorage.removeItem('mjs_history');
            localStorage.removeItem('mjs_settings');
            historyData = [];
            loadHistory();
            location.reload();
        }

    </script>
</body>
</html>